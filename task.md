# 順番待ちシステム - 実装タスク管理

このドキュメントは、実装タスクをユーザーストーリーとフェーズごとに管理します。

---

## Phase 0: 環境構築・基盤整備

### 環境セットアップ

- [x] T001: Dev Container 環境の動作確認
- [x] T002: MySQL コンテナの起動確認
- [x] T003: バックエンド依存パッケージのインストール確認
- [x] T004: フロントエンド依存パッケージのインストール確認
- [x] T005: 環境変数ファイルの設定確認

### 開発ツール・設定

- [x] T006: ESLint 設定（フロントエンド）
- [x] T007: Prettier 設定（フロントエンド）
- [x] T008: Black/Flake8 設定（バックエンド）
- [x] T009: Git pre-commit フック設定

---

## Phase 1: データベース・基本 API

### データベース設計・構築

- [ ] T010: データベーススキーマの実装（init.sql 更新）
- [ ] T011: queues テーブルの作成
- [ ] T012: settings テーブルの作成
- [ ] T013: インデックスの作成
- [ ] T014: デフォルトデータの投入（settings）
- [ ] T015: データベース初期化スクリプトのテスト

### バックエンド基盤

- [ ] T016: FastAPI プロジェクト構造の整理
- [ ] T017: データベース接続設定（SQLAlchemy）
- [ ] T018: モデル定義（queues テーブル）
- [ ] T019: モデル定義（settings テーブル）
- [ ] T020: データベースセッション管理の実装
- [ ] T021: CORS 設定

### ユーティリティ実装

- [ ] T022: UUID 生成関数（QR コードトークン用）
- [ ] T023: 受付番号採番ロジック
- [ ] T024: パスワードハッシュ化関数（bcrypt）
- [ ] T025: パスワード検証関数
- [ ] T026: バリデーション関数（人数制限）
- [ ] T027: ステータス遷移バリデーション

---

## Phase 2: 認証機能

### JWT 認証

- [ ] T028: JWT 生成関数の実装
- [ ] T029: JWT 検証関数の実装
- [ ] T030: 認証ミドルウェアの実装
- [ ] T031: ログイン API エンドポイント実装
- [ ] T032: トークンリフレッシュ API エンドポイント実装（オプション）

### パスワード管理

- [ ] T033: 初期パスワード設定の確認
- [ ] T034: パスワード変更 API エンドポイント実装
- [ ] T035: パスワード変更時のバリデーション

---

## Phase 3: 受付管理 API

### 受付登録（ユーザーストーリー: 店舗が新規受付を登録）

- [ ] T036: POST /api/queues エンドポイント実装
- [ ] T037: 入力バリデーション（人数制限）
- [ ] T038: 受付番号の自動採番
- [ ] T039: QR コードトークン生成
- [ ] T040: データベースへの保存
- [ ] T041: レスポンス（受付情報＋ QR コード用 URL）の返却

### 受付一覧取得（ユーザーストーリー: 店舗が待ち状況を確認）

- [ ] T042: GET /api/queues エンドポイント実装
- [ ] T043: ステータスフィルタ機能
- [ ] T044: ソート機能（受付時刻順）
- [ ] T045: ページネーション実装（オプション）

### 受付詳細取得

- [ ] T046: GET /api/queues/{id} エンドポイント実装
- [ ] T047: 存在チェック・エラーハンドリング

### 受付情報更新（ユーザーストーリー: 店舗が受付情報を編集）

- [ ] T048: PATCH /api/queues/{id} エンドポイント実装
- [ ] T049: 編集可能項目のバリデーション
- [ ] T050: 編集可能ステータスのチェック
- [ ] T051: データベース更新

### ステータス変更（ユーザーストーリー: 店舗が呼び出し・案内完了など）

- [ ] T052: PATCH /api/queues/{id}/status エンドポイント実装
- [ ] T053: 待機中 → 呼び出し中 の遷移
- [ ] T054: 呼び出し中 → 案内完了 の遷移
- [ ] T055: 呼び出し中 → 保留 の遷移
- [ ] T056: 保留 → 呼び出し中 の遷移（再呼び出し）
- [ ] T057: 任意のステータス → キャンセル の遷移
- [ ] T058: タイムスタンプの自動更新（called_at、completed_at 等）
- [ ] T059: ステータス遷移バリデーション

### ダッシュボード情報取得（ユーザーストーリー: 店舗がサマリーを確認）

- [ ] T060: GET /api/dashboard エンドポイント実装
- [ ] T061: 待ち組数の集計
- [ ] T062: 現在呼び出し中の番号取得
- [ ] T063: 最近の受付リスト取得

---

## Phase 4: 設定管理 API

### 店舗設定取得

- [ ] T064: GET /api/settings エンドポイント実装
- [ ] T065: パスワードハッシュを除外したレスポンス

### 店舗設定更新

- [ ] T066: PATCH /api/settings エンドポイント実装
- [ ] T067: 店舗名の更新
- [ ] T068: 営業時間の更新
- [ ] T069: 通知閾値の更新
- [ ] T070: バリデーション（通知閾値 1〜10）

---

## Phase 5: 顧客向け API

### QR コードアクセス（ユーザーストーリー: 顧客が待ち状況を確認）

- [ ] T071: GET /api/queue/view エンドポイント実装
- [ ] T072: トークン検証
- [ ] T073: 受付情報の取得
- [ ] T074: ステータスチェック（完了・キャンセルは無効）
- [ ] T075: 現在呼び出し中の番号取得
- [ ] T076: 自分の順番（あと何組）の計算
- [ ] T077: 全体の待ち組数の計算

---

## Phase 6: フロントエンド基盤構築

### Next.js プロジェクト構造

- [ ] T078: pages/ または app/ ディレクトリ構造の作成
- [ ] T079: レイアウトコンポーネントの実装
- [ ] T080: 共通スタイルの設定（CSS/Tailwind）
- [ ] T081: API 通信用の axios/fetch ラッパー実装
- [ ] T082: 認証コンテキストの実装（React Context API）
- [ ] T083: ローカルストレージ管理（JWT トークン保存）

### UI コンポーネントライブラリ選定・導入

- [ ] T084: UI ライブラリの選定（Material-UI / Chakra UI / shadcn/ui 等）
- [ ] T085: UI ライブラリのインストール
- [ ] T086: テーマ設定

---

## Phase 7: 店舗側管理画面 - ログイン

### ログイン画面（ユーザーストーリー: 店舗スタッフがログイン）

- [ ] T087: ログインページのルーティング設定（/admin/login）
- [ ] T088: ログインフォームコンポーネント実装
- [ ] T089: パスワード入力フィールド
- [ ] T090: ログインボタン
- [ ] T091: ログイン API との連携
- [ ] T092: JWT トークンの保存（LocalStorage/Cookie）
- [ ] T093: ログイン成功後のリダイレクト（ダッシュボードへ）
- [ ] T094: エラーハンドリング（パスワード誤り等）
- [ ] T095: 初回ログイン時のメッセージ表示

### 認証ガード

- [ ] T096: 認証チェックミドルウェアの実装
- [ ] T097: 未認証時のリダイレクト（ログイン画面へ）
- [ ] T098: トークン有効期限チェック

---

## Phase 8: 店舗側管理画面 - ダッシュボード

### ダッシュボード画面（ユーザーストーリー: 店舗が全体状況を把握）

- [ ] T099: ダッシュボードページのルーティング設定（/admin/dashboard）
- [ ] T100: レイアウト実装（ヘッダー＋メインコンテンツ）
- [ ] T101: 待ち組数の表示（大きく）
- [ ] T102: 現在呼び出し中番号の表示（大きく）
- [ ] T103: クイックアクションボタン（新規受付へ）
- [ ] T104: クイックアクションボタン（一覧へ）
- [ ] T105: 最近の受付リスト表示（直近 5 件）
- [ ] T106: ダッシュボード API との連携
- [ ] T107: 自動更新機能（ポーリング or WebSocket）

---

## Phase 9: 店舗側管理画面 - 新規受付

### 新規受付画面（ユーザーストーリー: 店舗が顧客を受付）

- [ ] T108: 新規受付ページのルーティング設定（/admin/reception/new）
- [ ] T109: 受付フォームコンポーネント実装
- [ ] T110: 大人人数入力フィールド（必須）
- [ ] T111: 子供人数入力フィールド（必須、0 可）
- [ ] T112: 座席タイプ選択（ラジオボタン: テーブル/カウンター）
- [ ] T113: 禁煙/喫煙選択（ラジオボタン、デフォルト: 禁煙）
- [ ] T114: 入力バリデーション（合計 8 人まで）
- [ ] T115: 登録ボタン
- [ ] T116: 受付登録 API との連携

### QR コード表示

- [ ] T117: QR コード生成ライブラリの導入（qrcode.react 等）
- [ ] T118: 登録成功後の QR コード表示
- [ ] T119: 受付番号の大きな表示
- [ ] T120: 待ち組数の表示
- [ ] T121: 「続けて受付」ボタン（フォームクリア）
- [ ] T122: 「ダッシュボードに戻る」ボタン

---

## Phase 10: 店舗側管理画面 - 待ち状況一覧

### 一覧画面（ユーザーストーリー: 店舗が受付を管理）

- [ ] T123: 一覧ページのルーティング設定（/admin/queues）
- [ ] T124: フィルタ UI の実装（ステータス選択）
- [ ] T125: ソート UI の実装（受付時刻昇順/降順）
- [ ] T126: 一覧テーブルコンポーネント実装
- [ ] T127: テーブルヘッダー（受付番号、受付時刻、人数、座席、禁煙/喫煙、ステータス、アクション）
- [ ] T128: テーブル行の表示
- [ ] T129: 一覧取得 API との連携

### アクションボタン

- [ ] T130: 「呼び出し」ボタン実装（待機中のみ表示）
- [ ] T131: 「保留」ボタン実装（呼び出し中のみ表示）
- [ ] T132: 「案内完了」ボタン実装（呼び出し中のみ表示）
- [ ] T133: 「キャンセル」ボタン実装（全ステータスで表示）
- [ ] T134: 「編集」ボタン実装
- [ ] T135: 各ボタンのステータス変更 API との連携
- [ ] T136: 確認ダイアログの実装（キャンセル時等）
- [ ] T137: 楽観的 UI 更新（即座に反映）

### 編集モーダル

- [ ] T138: 編集モーダルコンポーネント実装
- [ ] T139: 編集フォーム（新規受付と同様の項目）
- [ ] T140: 編集可能ステータスのチェック
- [ ] T141: 保存ボタン
- [ ] T142: キャンセルボタン
- [ ] T143: 更新 API との連携

---

## Phase 11: 店舗側管理画面 - 設定

### 設定画面（ユーザーストーリー: 店舗が設定を変更）

- [ ] T144: 設定ページのルーティング設定（/admin/settings）
- [ ] T145: パスワード変更セクション実装
- [ ] T146: 現在のパスワード入力フィールド
- [ ] T147: 新しいパスワード入力フィールド
- [ ] T148: パスワード確認入力フィールド
- [ ] T149: パスワード変更ボタン
- [ ] T150: パスワード変更 API との連携
- [ ] T151: バリデーション（パスワード一致確認）
- [ ] T152: 変更成功メッセージ

### 店舗情報設定

- [ ] T153: 店舗名入力フィールド
- [ ] T154: 営業開始時刻入力フィールド
- [ ] T155: 営業終了時刻入力フィールド
- [ ] T156: 通知閾値入力フィールド（1〜10）
- [ ] T157: 保存ボタン
- [ ] T158: 設定取得 API との連携
- [ ] T159: 設定更新 API との連携

---

## Phase 12: 店舗側管理画面 - 共通要素

### ヘッダー/ナビゲーション

- [ ] T160: ヘッダーコンポーネント実装
- [ ] T161: ロゴまたは店舗名表示
- [ ] T162: ナビゲーションメニュー（ダッシュボード、新規受付、一覧、設定）
- [ ] T163: ログアウトボタン
- [ ] T164: ログアウト機能実装（トークン削除＋ログイン画面へ）

### レスポンシブ対応

- [ ] T165: タブレット表示の確認・調整
- [ ] T166: PC 表示の確認・調整
- [ ] T167: モバイル表示の対応（オプション）

---

## Phase 13: 顧客向け画面

### QR コードアクセス画面（ユーザーストーリー: 顧客が待ち状況を確認）

- [ ] T168: 顧客向けページのルーティング設定（/queue/view）
- [ ] T169: URL パラメータからトークン取得
- [ ] T170: アクセスチェック API との連携
- [ ] T171: 無効トークンのエラー表示
- [ ] T172: 完了・キャンセル済みの表示

### 待ち状況表示

- [ ] T173: 現在呼び出し中の番号（大きく表示）
- [ ] T174: 自分の受付番号表示
- [ ] T175: あと何組待ちかの表示
- [ ] T176: 現在の待ち組数（全体）表示
- [ ] T177: 自動更新機能（ポーリング or WebSocket）

### スタイル・UX

- [ ] T178: 見やすいフォントサイズ設定
- [ ] T179: カラーリング（呼び出し中の番号を強調等）
- [ ] T180: ローディング表示
- [ ] T181: エラーメッセージのデザイン

---

## Phase 14: WebSocket リアルタイム更新

### バックエンド WebSocket 実装

- [ ] T182: FastAPI WebSocket エンドポイント実装
- [ ] T183: WebSocket 接続管理（インメモリ）
- [ ] T184: 接続時の処理
- [ ] T185: 切断時の処理
- [ ] T186: メッセージブロードキャスト機能
- [ ] T187: 受付追加時のブロードキャスト
- [ ] T188: ステータス変更時のブロードキャスト
- [ ] T189: 受付更新時のブロードキャスト

### フロントエンド WebSocket 実装（店舗側）

- [ ] T190: WebSocket 接続ライブラリの導入（オプション）
- [ ] T191: WebSocket 接続関数の実装
- [ ] T192: 自動再接続機能
- [ ] T193: メッセージ受信時の処理（ダッシュボード更新）
- [ ] T194: メッセージ受信時の処理（一覧更新）
- [ ] T195: 接続状態の表示

### フロントエンド WebSocket 実装（顧客側）

- [ ] T196: WebSocket 接続関数の実装
- [ ] T197: 自動再接続機能
- [ ] T198: メッセージ受信時の処理（待ち状況更新）
- [ ] T199: 接続状態の表示

---

## Phase 15: テスト・品質保証

### バックエンドテスト

- [ ] T200: ユニットテスト: 受付番号採番ロジック
- [ ] T201: ユニットテスト: バリデーション関数
- [ ] T202: ユニットテスト: パスワードハッシュ化・検証
- [ ] T203: API テスト: 受付登録エンドポイント
- [ ] T204: API テスト: 受付一覧取得エンドポイント
- [ ] T205: API テスト: ステータス変更エンドポイント
- [ ] T206: API テスト: 認証エンドポイント
- [ ] T207: 統合テスト: データベース操作
- [ ] T208: 統合テスト: WebSocket 接続

### フロントエンドテスト

- [ ] T209: コンポーネントテスト: ログインフォーム
- [ ] T210: コンポーネントテスト: 受付フォーム
- [ ] T211: コンポーネントテスト: 一覧テーブル
- [ ] T212: E2E テスト: ログイン〜新規受付〜QR コード表示
- [ ] T213: E2E テスト: 受付一覧〜ステータス変更
- [ ] T214: E2E テスト: 設定変更

### 手動テスト

- [ ] T215: 受付番号の連番確認（999 → 1000 の遷移含む）
- [ ] T216: すべてのステータス遷移の確認
- [ ] T217: 人数制限バリデーションの確認
- [ ] T218: QR コードアクセスの確認（有効・無効）
- [ ] T219: WebSocket リアルタイム更新の確認
- [ ] T220: レスポンシブ表示の確認

---

## Phase 16: ドキュメント・仕上げ

### ドキュメント整備

- [ ] T221: README.md の更新（セットアップ手順）
- [ ] T222: API 仕様書の作成（OpenAPI/Swagger）
- [ ] T223: デプロイ手順書の作成
- [ ] T224: トラブルシューティングガイドの追加

### セキュリティ確認

- [ ] T225: パスワードハッシュ化の確認
- [ ] T226: HTTPS 必須設定の確認
- [ ] T227: CORS 設定の確認
- [ ] T228: XSS 対策の確認
- [ ] T229: SQL インジェクション対策の確認
- [ ] T230: 認証トークンの有効期限設定

### パフォーマンス最適化

- [ ] T231: データベースクエリの最適化
- [ ] T232: インデックスの確認
- [ ] T233: フロントエンドバンドルサイズの確認
- [ ] T234: 画像最適化（QR コード等）
- [ ] T235: キャッシュ戦略の実装

---

## Phase 17: オプション機能（将来実装）

### Web Push 通知

- [ ] T236: Push 通知サービスの選定
- [ ] T237: バックエンド: 通知送信機能
- [ ] T238: フロントエンド: 通知許可リクエスト
- [ ] T239: 通知閾値に基づく自動送信
- [ ] T240: 通知送信履歴の管理（重複防止）

### 分析・レポート機能

- [ ] T241: 日別受付数の集計
- [ ] T242: 平均待ち時間の計算
- [ ] T243: ピーク時間帯の分析
- [ ] T244: レポート画面の実装

### データ管理

- [ ] T245: 古いデータの手動削除機能
- [ ] T246: データエクスポート機能（CSV 等）
- [ ] T247: データアーカイブ機能

---

## 進捗管理

### Phase 0: 環境構築・基盤整備

進捗: 0/9 (T001-T009)

### Phase 1: データベース・基本 API

進捗: 0/18 (T010-T027)

### Phase 2: 認証機能

進捗: 0/8 (T028-T035)

### Phase 3: 受付管理 API

進捗: 0/28 (T036-T063)

### Phase 4: 設定管理 API

進捗: 0/7 (T064-T070)

### Phase 5: 顧客向け API

進捗: 0/7 (T071-T077)

### Phase 6: フロントエンド基盤構築

進捗: 0/9 (T078-T086)

### Phase 7: 店舗側管理画面 - ログイン

進捗: 0/12 (T087-T098)

### Phase 8: 店舗側管理画面 - ダッシュボード

進捗: 0/9 (T099-T107)

### Phase 9: 店舗側管理画面 - 新規受付

進捗: 0/15 (T108-T122)

### Phase 10: 店舗側管理画面 - 待ち状況一覧

進捗: 0/21 (T123-T143)

### Phase 11: 店舗側管理画面 - 設定

進捗: 0/16 (T144-T159)

### Phase 12: 店舗側管理画面 - 共通要素

進捗: 0/8 (T160-T167)

### Phase 13: 顧客向け画面

進捗: 0/14 (T168-T181)

### Phase 14: WebSocket リアルタイム更新

進捗: 0/18 (T182-T199)

### Phase 15: テスト・品質保証

進捗: 0/21 (T200-T220)

### Phase 16: ドキュメント・仕上げ

進捗: 0/15 (T221-T235)

### Phase 17: オプション機能（将来実装）

進捗: 0/12 (T236-T247)

**全体進捗: 0/247 (T001-T247)**

---

## 注意事項

- チェックマークは実装完了時に `- [x]` に変更してください
- 各フェーズは順番に進めることを推奨しますが、並行作業も可能です
- オプション機能（Phase 17）は初期リリースでは実装不要です
- タスクの追加・変更が必要な場合は、このドキュメントを随時更新してください
