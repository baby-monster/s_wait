# 順番待ちシステム - 実装タスク管理

このドキュメントは、実装タスクをユーザーストーリーとフェーズごとに管理します。

---

## Phase 0: 環境構築・基盤整備

### 環境セットアップ
- [ ] Dev Container環境の動作確認
- [ ] MySQLコンテナの起動確認
- [ ] バックエンド依存パッケージのインストール確認
- [ ] フロントエンド依存パッケージのインストール確認
- [ ] 環境変数ファイルの設定確認

### 開発ツール・設定
- [ ] ESLint設定（フロントエンド）
- [ ] Prettier設定（フロントエンド）
- [ ] Black/Flake8設定（バックエンド）
- [ ] Git pre-commitフック設定

---

## Phase 1: データベース・基本API

### データベース設計・構築
- [ ] データベーススキーマの実装（init.sql更新）
- [ ] queuesテーブルの作成
- [ ] settingsテーブルの作成
- [ ] インデックスの作成
- [ ] デフォルトデータの投入（settings）
- [ ] データベース初期化スクリプトのテスト

### バックエンド基盤
- [ ] FastAPIプロジェクト構造の整理
- [ ] データベース接続設定（SQLAlchemy）
- [ ] モデル定義（queuesテーブル）
- [ ] モデル定義（settingsテーブル）
- [ ] データベースセッション管理の実装
- [ ] CORS設定

### ユーティリティ実装
- [ ] UUID生成関数（QRコードトークン用）
- [ ] 受付番号採番ロジック
- [ ] パスワードハッシュ化関数（bcrypt）
- [ ] パスワード検証関数
- [ ] バリデーション関数（人数制限）
- [ ] ステータス遷移バリデーション

---

## Phase 2: 認証機能

### JWT認証
- [ ] JWT生成関数の実装
- [ ] JWT検証関数の実装
- [ ] 認証ミドルウェアの実装
- [ ] ログインAPIエンドポイント実装
- [ ] トークンリフレッシュAPIエンドポイント実装（オプション）

### パスワード管理
- [ ] 初期パスワード設定の確認
- [ ] パスワード変更APIエンドポイント実装
- [ ] パスワード変更時のバリデーション

---

## Phase 3: 受付管理API

### 受付登録（ユーザーストーリー: 店舗が新規受付を登録）
- [ ] POST /api/queues エンドポイント実装
- [ ] 入力バリデーション（人数制限）
- [ ] 受付番号の自動採番
- [ ] QRコードトークン生成
- [ ] データベースへの保存
- [ ] レスポンス（受付情報＋QRコード用URL）の返却

### 受付一覧取得（ユーザーストーリー: 店舗が待ち状況を確認）
- [ ] GET /api/queues エンドポイント実装
- [ ] ステータスフィルタ機能
- [ ] ソート機能（受付時刻順）
- [ ] ページネーション実装（オプション）

### 受付詳細取得
- [ ] GET /api/queues/{id} エンドポイント実装
- [ ] 存在チェック・エラーハンドリング

### 受付情報更新（ユーザーストーリー: 店舗が受付情報を編集）
- [ ] PATCH /api/queues/{id} エンドポイント実装
- [ ] 編集可能項目のバリデーション
- [ ] 編集可能ステータスのチェック
- [ ] データベース更新

### ステータス変更（ユーザーストーリー: 店舗が呼び出し・案内完了など）
- [ ] PATCH /api/queues/{id}/status エンドポイント実装
- [ ] 待機中 → 呼び出し中 の遷移
- [ ] 呼び出し中 → 案内完了 の遷移
- [ ] 呼び出し中 → 保留 の遷移
- [ ] 保留 → 呼び出し中 の遷移（再呼び出し）
- [ ] 任意のステータス → キャンセル の遷移
- [ ] タイムスタンプの自動更新（called_at、completed_at等）
- [ ] ステータス遷移バリデーション

### ダッシュボード情報取得（ユーザーストーリー: 店舗がサマリーを確認）
- [ ] GET /api/dashboard エンドポイント実装
- [ ] 待ち組数の集計
- [ ] 現在呼び出し中の番号取得
- [ ] 最近の受付リスト取得

---

## Phase 4: 設定管理API

### 店舗設定取得
- [ ] GET /api/settings エンドポイント実装
- [ ] パスワードハッシュを除外したレスポンス

### 店舗設定更新
- [ ] PATCH /api/settings エンドポイント実装
- [ ] 店舗名の更新
- [ ] 営業時間の更新
- [ ] 通知閾値の更新
- [ ] バリデーション（通知閾値1〜10）

---

## Phase 5: 顧客向けAPI

### QRコードアクセス（ユーザーストーリー: 顧客が待ち状況を確認）
- [ ] GET /api/queue/view エンドポイント実装
- [ ] トークン検証
- [ ] 受付情報の取得
- [ ] ステータスチェック（完了・キャンセルは無効）
- [ ] 現在呼び出し中の番号取得
- [ ] 自分の順番（あと何組）の計算
- [ ] 全体の待ち組数の計算

---

## Phase 6: フロントエンド基盤構築

### Next.jsプロジェクト構造
- [ ] pages/ または app/ ディレクトリ構造の作成
- [ ] レイアウトコンポーネントの実装
- [ ] 共通スタイルの設定（CSS/Tailwind）
- [ ] API通信用のaxios/fetchラッパー実装
- [ ] 認証コンテキストの実装（React Context API）
- [ ] ローカルストレージ管理（JWTトークン保存）

### UI コンポーネントライブラリ選定・導入
- [ ] UIライブラリの選定（Material-UI / Chakra UI / shadcn/ui等）
- [ ] UIライブラリのインストール
- [ ] テーマ設定

---

## Phase 7: 店舗側管理画面 - ログイン

### ログイン画面（ユーザーストーリー: 店舗スタッフがログイン）
- [ ] ログインページのルーティング設定（/admin/login）
- [ ] ログインフォームコンポーネント実装
- [ ] パスワード入力フィールド
- [ ] ログインボタン
- [ ] ログインAPIとの連携
- [ ] JWTトークンの保存（LocalStorage/Cookie）
- [ ] ログイン成功後のリダイレクト（ダッシュボードへ）
- [ ] エラーハンドリング（パスワード誤り等）
- [ ] 初回ログイン時のメッセージ表示

### 認証ガード
- [ ] 認証チェックミドルウェアの実装
- [ ] 未認証時のリダイレクト（ログイン画面へ）
- [ ] トークン有効期限チェック

---

## Phase 8: 店舗側管理画面 - ダッシュボード

### ダッシュボード画面（ユーザーストーリー: 店舗が全体状況を把握）
- [ ] ダッシュボードページのルーティング設定（/admin/dashboard）
- [ ] レイアウト実装（ヘッダー＋メインコンテンツ）
- [ ] 待ち組数の表示（大きく）
- [ ] 現在呼び出し中番号の表示（大きく）
- [ ] クイックアクションボタン（新規受付へ）
- [ ] クイックアクションボタン（一覧へ）
- [ ] 最近の受付リスト表示（直近5件）
- [ ] ダッシュボードAPIとの連携
- [ ] 自動更新機能（ポーリング or WebSocket）

---

## Phase 9: 店舗側管理画面 - 新規受付

### 新規受付画面（ユーザーストーリー: 店舗が顧客を受付）
- [ ] 新規受付ページのルーティング設定（/admin/reception/new）
- [ ] 受付フォームコンポーネント実装
- [ ] 大人人数入力フィールド（必須）
- [ ] 子供人数入力フィールド（必須、0可）
- [ ] 座席タイプ選択（ラジオボタン: テーブル/カウンター）
- [ ] 禁煙/喫煙選択（ラジオボタン、デフォルト: 禁煙）
- [ ] 入力バリデーション（合計8人まで）
- [ ] 登録ボタン
- [ ] 受付登録APIとの連携

### QRコード表示
- [ ] QRコード生成ライブラリの導入（qrcode.react等）
- [ ] 登録成功後のQRコード表示
- [ ] 受付番号の大きな表示
- [ ] 待ち組数の表示
- [ ] 「続けて受付」ボタン（フォームクリア）
- [ ] 「ダッシュボードに戻る」ボタン

---

## Phase 10: 店舗側管理画面 - 待ち状況一覧

### 一覧画面（ユーザーストーリー: 店舗が受付を管理）
- [ ] 一覧ページのルーティング設定（/admin/queues）
- [ ] フィルタUIの実装（ステータス選択）
- [ ] ソートUIの実装（受付時刻昇順/降順）
- [ ] 一覧テーブルコンポーネント実装
- [ ] テーブルヘッダー（受付番号、受付時刻、人数、座席、禁煙/喫煙、ステータス、アクション）
- [ ] テーブル行の表示
- [ ] 一覧取得APIとの連携

### アクションボタン
- [ ] 「呼び出し」ボタン実装（待機中のみ表示）
- [ ] 「保留」ボタン実装（呼び出し中のみ表示）
- [ ] 「案内完了」ボタン実装（呼び出し中のみ表示）
- [ ] 「キャンセル」ボタン実装（全ステータスで表示）
- [ ] 「編集」ボタン実装
- [ ] 各ボタンのステータス変更APIとの連携
- [ ] 確認ダイアログの実装（キャンセル時等）
- [ ] 楽観的UI更新（即座に反映）

### 編集モーダル
- [ ] 編集モーダルコンポーネント実装
- [ ] 編集フォーム（新規受付と同様の項目）
- [ ] 編集可能ステータスのチェック
- [ ] 保存ボタン
- [ ] キャンセルボタン
- [ ] 更新APIとの連携

---

## Phase 11: 店舗側管理画面 - 設定

### 設定画面（ユーザーストーリー: 店舗が設定を変更）
- [ ] 設定ページのルーティング設定（/admin/settings）
- [ ] パスワード変更セクション実装
- [ ] 現在のパスワード入力フィールド
- [ ] 新しいパスワード入力フィールド
- [ ] パスワード確認入力フィールド
- [ ] パスワード変更ボタン
- [ ] パスワード変更APIとの連携
- [ ] バリデーション（パスワード一致確認）
- [ ] 変更成功メッセージ

### 店舗情報設定
- [ ] 店舗名入力フィールド
- [ ] 営業開始時刻入力フィールド
- [ ] 営業終了時刻入力フィールド
- [ ] 通知閾値入力フィールド（1〜10）
- [ ] 保存ボタン
- [ ] 設定取得APIとの連携
- [ ] 設定更新APIとの連携

---

## Phase 12: 店舗側管理画面 - 共通要素

### ヘッダー/ナビゲーション
- [ ] ヘッダーコンポーネント実装
- [ ] ロゴまたは店舗名表示
- [ ] ナビゲーションメニュー（ダッシュボード、新規受付、一覧、設定）
- [ ] ログアウトボタン
- [ ] ログアウト機能実装（トークン削除＋ログイン画面へ）

### レスポンシブ対応
- [ ] タブレット表示の確認・調整
- [ ] PC表示の確認・調整
- [ ] モバイル表示の対応（オプション）

---

## Phase 13: 顧客向け画面

### QRコードアクセス画面（ユーザーストーリー: 顧客が待ち状況を確認）
- [ ] 顧客向けページのルーティング設定（/queue/view）
- [ ] URLパラメータからトークン取得
- [ ] アクセスチェックAPIとの連携
- [ ] 無効トークンのエラー表示
- [ ] 完了・キャンセル済みの表示

### 待ち状況表示
- [ ] 現在呼び出し中の番号（大きく表示）
- [ ] 自分の受付番号表示
- [ ] あと何組待ちかの表示
- [ ] 現在の待ち組数（全体）表示
- [ ] 自動更新機能（ポーリング or WebSocket）

### スタイル・UX
- [ ] 見やすいフォントサイズ設定
- [ ] カラーリング（呼び出し中の番号を強調等）
- [ ] ローディング表示
- [ ] エラーメッセージのデザイン

---

## Phase 14: WebSocketリアルタイム更新

### バックエンド WebSocket実装
- [ ] FastAPI WebSocketエンドポイント実装
- [ ] WebSocket接続管理（インメモリ）
- [ ] 接続時の処理
- [ ] 切断時の処理
- [ ] メッセージブロードキャスト機能
- [ ] 受付追加時のブロードキャスト
- [ ] ステータス変更時のブロードキャスト
- [ ] 受付更新時のブロードキャスト

### フロントエンド WebSocket実装（店舗側）
- [ ] WebSocket接続ライブラリの導入（オプション）
- [ ] WebSocket接続関数の実装
- [ ] 自動再接続機能
- [ ] メッセージ受信時の処理（ダッシュボード更新）
- [ ] メッセージ受信時の処理（一覧更新）
- [ ] 接続状態の表示

### フロントエンド WebSocket実装（顧客側）
- [ ] WebSocket接続関数の実装
- [ ] 自動再接続機能
- [ ] メッセージ受信時の処理（待ち状況更新）
- [ ] 接続状態の表示

---

## Phase 15: テスト・品質保証

### バックエンドテスト
- [ ] ユニットテスト: 受付番号採番ロジック
- [ ] ユニットテスト: バリデーション関数
- [ ] ユニットテスト: パスワードハッシュ化・検証
- [ ] APIテスト: 受付登録エンドポイント
- [ ] APIテスト: 受付一覧取得エンドポイント
- [ ] APIテスト: ステータス変更エンドポイント
- [ ] APIテスト: 認証エンドポイント
- [ ] 統合テスト: データベース操作
- [ ] 統合テスト: WebSocket接続

### フロントエンドテスト
- [ ] コンポーネントテスト: ログインフォーム
- [ ] コンポーネントテスト: 受付フォーム
- [ ] コンポーネントテスト: 一覧テーブル
- [ ] E2Eテスト: ログイン〜新規受付〜QRコード表示
- [ ] E2Eテスト: 受付一覧〜ステータス変更
- [ ] E2Eテスト: 設定変更

### 手動テスト
- [ ] 受付番号の連番確認（999 → 1000の遷移含む）
- [ ] すべてのステータス遷移の確認
- [ ] 人数制限バリデーションの確認
- [ ] QRコードアクセスの確認（有効・無効）
- [ ] WebSocketリアルタイム更新の確認
- [ ] レスポンシブ表示の確認

---

## Phase 16: ドキュメント・仕上げ

### ドキュメント整備
- [ ] README.mdの更新（セットアップ手順）
- [ ] API仕様書の作成（OpenAPI/Swagger）
- [ ] デプロイ手順書の作成
- [ ] トラブルシューティングガイドの追加

### セキュリティ確認
- [ ] パスワードハッシュ化の確認
- [ ] HTTPS必須設定の確認
- [ ] CORS設定の確認
- [ ] XSS対策の確認
- [ ] SQLインジェクション対策の確認
- [ ] 認証トークンの有効期限設定

### パフォーマンス最適化
- [ ] データベースクエリの最適化
- [ ] インデックスの確認
- [ ] フロントエンドバンドルサイズの確認
- [ ] 画像最適化（QRコード等）
- [ ] キャッシュ戦略の実装

---

## Phase 17: オプション機能（将来実装）

### Web Push通知
- [ ] Push通知サービスの選定
- [ ] バックエンド: 通知送信機能
- [ ] フロントエンド: 通知許可リクエスト
- [ ] 通知閾値に基づく自動送信
- [ ] 通知送信履歴の管理（重複防止）

### 分析・レポート機能
- [ ] 日別受付数の集計
- [ ] 平均待ち時間の計算
- [ ] ピーク時間帯の分析
- [ ] レポート画面の実装

### データ管理
- [ ] 古いデータの手動削除機能
- [ ] データエクスポート機能（CSV等）
- [ ] データアーカイブ機能

---

## 進捗管理

### Phase 0: 環境構築・基盤整備
進捗: 0/8

### Phase 1: データベース・基本API
進捗: 0/17

### Phase 2: 認証機能
進捗: 0/8

### Phase 3: 受付管理API
進捗: 0/25

### Phase 4: 設定管理API
進捗: 0/7

### Phase 5: 顧客向けAPI
進捗: 0/7

### Phase 6: フロントエンド基盤構築
進捗: 0/9

### Phase 7: 店舗側管理画面 - ログイン
進捗: 0/11

### Phase 8: 店舗側管理画面 - ダッシュボード
進捗: 0/9

### Phase 9: 店舗側管理画面 - 新規受付
進捗: 0/13

### Phase 10: 店舗側管理画面 - 待ち状況一覧
進捗: 0/23

### Phase 11: 店舗側管理画面 - 設定
進捗: 0/17

### Phase 12: 店舗側管理画面 - 共通要素
進捗: 0/9

### Phase 13: 顧客向け画面
進捗: 0/14

### Phase 14: WebSocketリアルタイム更新
進捗: 0/17

### Phase 15: テスト・品質保証
進捗: 0/21

### Phase 16: ドキュメント・仕上げ
進捗: 0/14

### Phase 17: オプション機能（将来実装）
進捗: 0/12

**全体進捗: 0/220**

---

## 注意事項

- チェックマークは実装完了時に `- [x]` に変更してください
- 各フェーズは順番に進めることを推奨しますが、並行作業も可能です
- オプション機能（Phase 17）は初期リリースでは実装不要です
- タスクの追加・変更が必要な場合は、このドキュメントを随時更新してください
